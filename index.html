<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enigma Universal - Downloader</title>
<link rel="icon" type="image/x-icon" href="favi.ico">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
<style>
body{font-family:'Inter',sans-serif;margin:0;overflow:hidden;background:#fff;color:#0f172a}
#canvas-container{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
#ui-layer{position:relative;z-index:10;width:100%;height:100vh;display:flex;align-items:center;justify-content:center}
.pro-card{background:rgba(255,255,255,.85);backdrop-filter:blur(12px);border:1px solid rgba(0,0,0,.08);box-shadow:0 20px 25px -5px rgba(0,0,0,.05);border-radius:24px}
.pro-input{background:#fff;border:1px solid #e2e8f0;color:#0f172a;border-radius:12px}
.pro-input:focus{outline:none;border-color:#000;box-shadow:0 0 0 4px rgba(0,0,0,.05)}
.btn-pro{background:#000;color:#fff;border-radius:12px;font-weight:600}
.btn-pro:hover{background:#222}
.loader{width:20px;height:20px;border:2px solid #e2e8f0;border-bottom-color:#000;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.fade-in{animation:fade .4s ease forwards}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
.confetti{position:fixed;width:8px;height:8px;top:-10px;z-index:50;animation:fall 1.2s linear forwards}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:0}}
</style>
</head>

<body>
<div id="canvas-container"></div>

<div id="ui-layer" class="px-4">
<div class="pro-card w-full max-w-md p-8 text-center">
<div class="mb-6">
<div class="w-14 h-14 bg-black rounded-2xl flex items-center justify-center mx-auto mb-4">
<i data-lucide="globe" class="w-7 h-7 text-white"></i>
</div>
<h1 class="text-3xl font-extrabold">Enigma Universal</h1>
<p class="text-slate-500 text-sm mt-2">Download from Insta, YouTube & more</p>
</div>

<div class="space-y-4">
<div class="flex bg-slate-100 p-1 rounded-xl">
<button id="btnVideo" onclick="setMode('video')" class="flex-1 py-2 bg-white rounded-lg font-semibold">Video</button>
<button id="btnAudio" onclick="setMode('audio')" class="flex-1 py-2 rounded-lg text-slate-500">Audio</button>
</div>

<input id="urlInput" class="pro-input w-full py-3 px-4 text-sm" placeholder="Paste link">

<button id="downloadBtn" onclick="processDownload()" class="btn-pro w-full py-3">Download</button>
</div>

<div id="loadingState" class="hidden mt-6 flex items-center justify-center gap-2">
<span class="loader"></span><span class="text-sm">Processing...</span>
</div>

<div id="resultState" class="hidden mt-6 fade-in text-green-700 font-semibold">Download started</div>
<div id="errorState" class="hidden mt-4 fade-in text-red-600 text-sm"></div>
</div>
</div>

<script>
const scene=new THREE.Scene()
scene.fog=new THREE.FogExp2(0xffffff,.002)
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000)
const renderer=new THREE.WebGLRenderer({alpha:true,antialias:true})
renderer.setSize(innerWidth,innerHeight)
document.getElementById("canvas-container").appendChild(renderer.domElement)
camera.position.z=6

const geo=new THREE.BufferGeometry()
const count=1200
const pos=new Float32Array(count*3)
for(let i=0;i<count*3;i+=3){pos[i]=(Math.random()-.5)*30;pos[i+1]=(Math.random()-.5)*30;pos[i+2]=(Math.random()-.5)*20}
geo.setAttribute("position",new THREE.BufferAttribute(pos,3))
const mesh=new THREE.Points(geo,new THREE.PointsMaterial({size:.05,color:0x000000,opacity:.5,transparent:true}))
scene.add(mesh)

function animate(){requestAnimationFrame(animate);mesh.rotation.y+=.0005;renderer.render(scene,camera)}
animate()
addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)})

let currentMode="video"
function setMode(m){currentMode=m}
function showError(t){document.getElementById("errorState").innerText=t;document.getElementById("errorState").classList.remove("hidden")}
async function processDownload(){
const url=document.getElementById("urlInput").value.trim()
if(!url)return showError("Paste a valid URL")
document.getElementById("downloadBtn").classList.add("hidden")
document.getElementById("loadingState").classList.remove("hidden")

try{
const res=await fetch("/download",{method:"POST",headers:{
"Content-Type":"application/json",
"X-API-Key":"IGDL_8f92a1c9e4d74e8dbfa8c3d6e12a7b90c"
},body:JSON.stringify({url,type:currentMode})})
const data=await res.json()
if(!res.ok)throw new Error(data.error)
location.href=data.download_url
}catch(e){showError(e.message)}
finally{
document.getElementById("loadingState").classList.add("hidden")
document.getElementById("downloadBtn").classList.remove("hidden")
}}
lucide.createIcons()
</script>
</body>
</html>
